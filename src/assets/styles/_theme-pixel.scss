/**
 * 像素风格主题
 * 核心在于模拟8位/16位像素艺术的视觉效果
 */

:root,
body.theme-pixel {
  /* ===== 颜色变量 - 像素风常见调色板 ===== */
  --primary-color: #008080; /* 青色，经典像素游戏主色 */
  --primary-dark: #005f5f;
  --secondary-color: #800080; /* 紫色，辅助色 */
  --success-color: #00a000;
  --success-light: #a0ffa0;
  --warning-color: #c0c000;
  --warning-light: #ffff80;
  --danger-color: #a00000;
  --danger-light: #ffa0a0;
  --info-color: #008080;
  --info-light: #80ffff;
  
  --bg-gradient: linear-gradient(135deg, #404040 0%, #202020 100%); /* 暗色渐变背景 */
  --bg-main: #303030; /* 主背景色 */
  --bg-card: #c0c0c0; /* 银色/灰色，模拟老式屏幕 */
  --bg-header: #808080; /* 中灰色 */
  --bg-input: #f0f0f0; /* 浅灰色 */
  --bg-hover: #d8d8d8; /* 悬停色 */
  --bg-button-group: #a0a0a0;
  
  --text-primary: #000000; /* 纯黑色文本 */
  --text-secondary: #303030;
  --text-muted: #606060;
  --text-white: #ffffff; /* 纯白色文本 */
  
  --border-color: #505050; /* 深灰色边框 */
  --border-radius: 0; /* 像素风无圆角 */
  --border-width: 2px; /* 更粗的边框 */
  
  --shadow-card: 4px 4px #404040; /* 像素化阴影 */
  --shadow-hover: 6px 6px #606060; /* 像素化悬停阴影 */
  --shadow-sm: 2px 2px #303030;
  --shadow-md: 4px 4px #404040;
  --shadow-lg: 6px 6px #505050;
  --shadow-xl: 8px 8px #606060;
  
  --btn-success: #00a000;
  --btn-primary: #008080;
  --btn-warning: #c0c000;
  --btn-danger: #a00000;
  --btn-info: #008080;
  --btn-secondary: #808080;
  
  /* ===== 字体 - 像素风字体，需要引入外部字体或使用系统自带的等宽字体 ===== */
  --font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; /* 使用全局统一字体 */
  --font-weight-normal: 400;
  --font-weight-medium: 700; /* 像素字体粗细变化不明显，用700强调 */
  --font-weight-bold: 900;
  
  /* 额外像素风专属变量 */
  --pixel-size: 2px; /* 定义像素单位大小 */
  --pixel-border-color: #202020;
  --pixel-shadow-color: #101010;
}

body.theme-pixel {
  font-family: var(--font-family);
  color: var(--text-primary);
  background-color: #202020; /* 整体背景 */
  
  /* 全局应用像素化效果 */
  * {
    image-rendering: pixelated; /* 确保图片和图标像素化 */
    -ms-interpolation-mode: nearest-neighbor; /* IE兼容 */
  }

  /* 差异化样式 */
  .app-container {
    background: var(--bg-gradient);
  }
  
  /* 使用指南页面特殊处理 - 覆盖所有变量 */
  .doc-page {
    // 覆盖CSS变量，确保浅色文字
    --text-primary: #f0f0f0;
    --text-secondary: #c0c0c0;
    --text-muted: #a0a0a0;
    --bg-card: #505050;
    --bg-input: #303030;
    --bg-hover: #606060;
    --border-color: #606060;
    
    background: #404040 !important; /* 深灰色背景 */
    
    .doc-header {
      background: #606060 !important; /* 中灰色头部 */
      border-bottom: var(--pixel-size) solid #202020;
    }
    
    .doc-page-title {
      color: #f0f0f0 !important;
    }
    
    .back-btn {
      background: var(--primary-color) !important;
      color: #ffffff !important;
      border: var(--pixel-size) solid #005f5f;
    }
    
    .refresh-btn {
      background: var(--primary-color) !important;
      color: #ffffff !important;
      border: var(--pixel-size) solid #005f5f;
    }
    
    .doc-main {
      background: #404040;
    }
    
    .doc-container {
      background: transparent;
    }
    
    .doc-content-wrapper {
      background: transparent;
    }
    
    .doc-toc {
      background: #505050 !important; /* 深灰色目录背景 */
      border: var(--pixel-size) solid #202020 !important;
      
      .toc-header h3 {
        color: #f0f0f0 !important;
        border-bottom-color: #303030;
      }
      
      .toc-item a {
        color: #d0d0d0 !important;
        
        &:hover {
          color: #ffffff !important;
          background: #606060 !important;
        }
      }
      
      .toc-item.active a {
        color: #ffffff !important;
        background: var(--primary-color) !important;
      }
    }
    
    .markdown-body {
      // 通过覆盖变量，所有使用 var(--text-primary) 的元素都会自动变成浅色
      // 不需要单独设置每个元素的颜色
      
      
      // 行内代码 - 经典DOS终端绿色
      :deep(code) {
        background: #202020 !important;
        color: #00ff00 !important;
        border-color: #404040 !important;
      }
      
      // 代码块 - 经典DOS终端绿色
      :deep(pre) {
        background: #202020 !important;
        border: var(--pixel-size) solid #404040 !important;
        
        code {
          background: transparent !important;
          color: #00ff00 !important;
        }
      }
      
      // 链接 - 经典青色
      :deep(a) {
        color: #00ffff !important;
        border-bottom-color: #00ffff !important;
        
        &:hover {
          color: #000000 !important;
          background: #00ffff !important;
          border-bottom-color: #00ffff !important;
        }
      }
      
      // 引用块
      :deep(blockquote) {
        background: #505050 !important;
        border-left-color: var(--primary-color) !important;
        
        &::before {
          color: var(--primary-color) !important;
        }
      }
      
      // 表格
      :deep(table) {
        background: #303030 !important;
        border: var(--pixel-size) solid #202020 !important;
        
        th {
          background: #606060 !important;
          color: #ffffff !important;
          border-color: #404040 !important;
        }
        
        td {
          background: #404040 !important;
          color: #d0d0d0 !important;
          border-color: #505050 !important;
        }
        
        tr:nth-child(even) td {
          background: #4a4a4a !important;
        }
        
        tr:hover td {
          background: #555555 !important;
          color: #ffffff !important;
        }
      }
      
      // 水平线
      :deep(hr) {
        background: linear-gradient(to right, transparent, #808080, transparent) !important;
      }
      
      // 加粗
      :deep(strong) {
        color: #ffffff !important;
        
        &::after {
          background: #00ffff !important;
          opacity: 0.3;
        }
      }
      
      // 斜体
      :deep(em) {
        color: #c0c0c0 !important;
      }
      
      // 删除线
      :deep(del) {
        color: #808080 !important;
      }
      
      // 图片边框
      :deep(img:not([src*="shields.io"]):not([src*="badge"])) {
        border-color: #606060 !important;
        box-shadow: 4px 4px #303030 !important;
        
        &:hover {
          box-shadow: 6px 6px #404040 !important;
        }
      }
      
      // 徽章行
      :deep(p.badge-row) {
        img {
          filter: brightness(1.1);
        }
      }
    }
    
    // 加载和错误状态
    .loading-state {
      color: #d0d0d0 !important;
      
      p {
        color: #d0d0d0 !important;
      }
    }
    
    .loading-spinner {
      border-color: #505050 !important;
      border-top-color: var(--primary-color) !important;
    }
    
    .error-state {
      color: #d0d0d0 !important;
      
      p {
        color: #d0d0d0 !important;
      }
      
      .error-message {
        color: #ff8080 !important;
      }
      
      .fallback-hint {
        color: #a0a0a0 !important;
      }
    }
    
    // 回到顶部按钮
    .back-to-top {
      background: var(--primary-color) !important;
      color: #ffffff !important;
      border: var(--pixel-size) solid #005f5f;
      box-shadow: 4px 4px #303030 !important;
      
      &:hover {
        background: #00a0a0 !important;
        box-shadow: 6px 6px #404040 !important;
      }
    }
  }
  
  .header {
    box-shadow: 6px 6px var(--pixel-shadow-color);
    border-bottom: var(--pixel-size) solid var(--pixel-border-color);
  }
  
  .category-header {
    background: var(--primary-color);
    color: var(--text-white);
    border: var(--pixel-size) solid var(--pixel-border-color);
    box-shadow: var(--pixel-size) var(--pixel-size) var(--pixel-shadow-color);
  }
  
  .item {
    background: var(--bg-card);
    border: var(--pixel-size) solid var(--border-color);
    border-radius: var(--border-radius);
    margin-bottom: calc(var(--pixel-size) * 2);
  }

  .item:hover {
    background: #e0e0e0;
    box-shadow: var(--pixel-size) var(--pixel-size) #606060;
  }
  
  .item.completed {
    background: #a0ffa0; /* 鲜绿色 */
    border-color: #008000;
  }
  
  .stat-item {
    background: var(--primary-color);
    color: var(--text-white);
    border: var(--pixel-size) solid var(--pixel-border-color);
    box-shadow: var(--pixel-size) var(--pixel-size) var(--pixel-shadow-color);
    border-radius: var(--border-radius);
  }
  
  .nav-menu {
    border-color: var(--border-color);
    border-bottom: var(--pixel-size) solid var(--pixel-border-color);
  }
  
  .nav-link {
    color: var(--text-primary);
    
    &:hover {
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
    }
    
    &.danger:hover {
      color: var(--btn-danger);
      border-bottom-color: var(--btn-danger);
    }
  }
  
  .modal-content {
    border: var(--pixel-size) solid var(--pixel-border-color);
    box-shadow: calc(var(--pixel-size) * 2) calc(var(--pixel-size) * 2) var(--pixel-shadow-color);
    border-radius: var(--border-radius);
  }

  .modal-header {
    background: var(--primary-color);
    color: var(--text-white);
    border-bottom: var(--pixel-size) solid var(--pixel-border-color);
    
    h3, .close {
      color: var(--text-white);
    }
  }

  .config-tabs {
    border-bottom: var(--pixel-size) solid var(--border-color);
  }

  .tab-btn {
    border-bottom: var(--pixel-size) solid transparent;
    &:hover {
      color: var(--primary-color);
    }
    &.active {
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
    }
  }

  .btn {
    border-radius: var(--border-radius);
    border: var(--pixel-size) solid var(--pixel-border-color);
    box-shadow: var(--pixel-size) var(--pixel-size) var(--pixel-shadow-color);

    &:not(:disabled):hover {
      transform: translate(calc(var(--pixel-size) * -1), calc(var(--pixel-size) * -1));
      box-shadow: calc(var(--pixel-size) * 2) calc(var(--pixel-size) * 2) var(--pixel-shadow-color);
    }
  }

  .btn-primary {
    background: var(--btn-primary);
  }
  
  .btn-secondary {
    background: var(--btn-secondary);
  }

  .setting-group input,
  .setting-group select,
  .setting-group textarea {
    border: var(--pixel-size) solid var(--border-color);
    border-radius: var(--border-radius);
    &:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: calc(var(--pixel-size) * 2) calc(var(--pixel-size) * 2) rgba(0,0,0,0.1);
    }
  }

  .config-info {
    border-left: calc(var(--pixel-size) * 2) solid var(--primary-color);
    border-radius: var(--border-radius);
  }

  .test-result {
    border: var(--pixel-size) solid var(--border-color);
    border-radius: var(--border-radius);
  }

  .test-result.success {
    background: var(--btn-success);
    color: var(--text-white);
  }

  .test-result.error {
    background: var(--btn-danger);
    color: var(--text-white);
  }
  
  /* 智能推荐按钮像素风格 */
  .btn-recommendation {
    background: var(--btn-primary) !important;
    color: var(--text-white) !important;
    border: var(--pixel-size) solid var(--pixel-border-color) !important;
    box-shadow: var(--pixel-size) var(--pixel-size) var(--pixel-shadow-color);
    border-radius: 0 !important;
    
    &:hover:not(:disabled) {
      background: #00a0a0 !important;
      transform: translate(calc(var(--pixel-size) * -1), calc(var(--pixel-size) * -1));
      box-shadow: calc(var(--pixel-size) * 2) calc(var(--pixel-size) * 2) var(--pixel-shadow-color);
    }
  }
  
  /* 撤销按钮像素风格 */
  .btn-undo {
    background: var(--btn-success) !important;
    color: var(--text-white) !important;
    border: var(--pixel-size) solid var(--pixel-border-color) !important;
    box-shadow: var(--pixel-size) var(--pixel-size) var(--pixel-shadow-color);
    border-radius: 0 !important;
    
    &:hover:not(:disabled) {
      background: #00c000 !important;
      transform: translate(calc(var(--pixel-size) * -1), calc(var(--pixel-size) * -1));
      box-shadow: calc(var(--pixel-size) * 2) calc(var(--pixel-size) * 2) var(--pixel-shadow-color);
    }
    
    &:disabled {
      background: var(--btn-secondary) !important;
      border-color: var(--border-color) !important;
      box-shadow: none;
      filter: grayscale(0.5);
    }
  }
  
  /* 添加分类卡片像素风格 */
  .add-category-card {
    border: var(--pixel-size) dashed var(--primary-color) !important;
    border-radius: 0 !important;
    box-shadow: var(--pixel-size) var(--pixel-size) var(--pixel-shadow-color);
    
    &:hover {
      border-color: #00a0a0 !important;
      background: var(--bg-card) !important;
      box-shadow: calc(var(--pixel-size) * 2) calc(var(--pixel-size) * 2) var(--pixel-shadow-color);
    }
  }
  
  .add-category-input-card {
    border: var(--pixel-size) solid var(--primary-color) !important;
    border-radius: 0 !important;
    box-shadow: var(--pixel-size) var(--pixel-size) var(--pixel-shadow-color);
  }

  .category-input {
    border: var(--pixel-size) solid var(--border-color) !important;
    border-radius: 0 !important;
    
    &:focus {
      border-color: var(--primary-color) !important;
      box-shadow: var(--pixel-size) var(--pixel-size) var(--primary-color) !important; // 像素风格的焦点阴影
    }
  }
}
